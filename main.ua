# Experimental!

I ~ "git:https://github.com/Marcos-cat/iris" ~ Color Draw Key T
Cat ~ "./catppuccin.ua"
â”Œâ”€â•´Status
  |Running
  |Paused
  |Intermission # When you just lost a ball but you have another, that lil pause
  |Lost
â””â”€â•´

# Constants
H â† 800
W â† 1000

PadH â† 30
PadW â† 200

BallW    â† 10
BallH    â† 10
BallSize â† 0.5

BlockH    â† 20
NumBlocks â† 10
BlockGap  â† 10
MarginH   â† 50
MarginW   â† 30
NumRows   â† 6 # How many lines
PadVel    â† Ã—i 1/1
BlockColors â† [Cat~Green
               Cat~Yellow
               Cat~Rosewater
               Cat~Lavander
               Cat~Teal]

# Definitions
~Ball [Vel Pos]
~Block {Color Size Pos}
â”Œâ”€â•´BlockInit
  PBlockW â† Ã·NumBlocks -Ã—â‚‚MarginW W # PseudoWidth
  BlockW  â† -BlockGap PBlockW

  Xs        â† +MarginWÃ—PBlockW â‡¡NumBlocks
  Ys        â†š â¢(âŠ‚++BlockH BlockGapâŠ¸âŠ¢|<NumRowsâ§») [MarginH]
  Positions â†š â™­âŠâ„‚ Xs Ys
  RandomCol â† (âŠ¡âŠ¸(âŒŠÃ—âš‚â§»)BlockColors)
  New       â† â‰¡(Block RandomCol â„‚BlockW BlockH) Positions
â””â”€â•´

~St {
  Pad â† â„‚Ã·â‚‚-PadW W -Ã—2.5PadH H
  Ball â† Ball Ë™â„‚BallSize â„‚Ã·â‚ˆW Ã·â‚ƒH
  Blocks â† BlockInit
  Lives â† 3
  Score â† 100
  Status â† Status~Running
}

DrawPad              â† |1.0 I~Draw~Rect Cat~Sapphire â„‚PadW PadH                            # ? PadPos
DrawBlocks           â† |1.0 â‰¡(I~Draw~Rect Â°{âŠ™âŠ™âŠ™})                                          # ? Blocks
DrawBall             â† |1.0 I~Draw~Rect Cat~Text â„‚BallW BallH âŠ£                            # ? Ball
DrawLives            â† |1.0 I~Draw~Text Cat~Text 20 Ë™â„‚ Ã·â‚‚MarginW âŠ‚"Lives: " Â°â‹•             # ? Lives
DrawScore            â† |1.0 I~Draw~Text Cat~Text 20 Ëœâ„‚ Ã·â‚‚MarginW âŠ¸(-âŠ™WÃ—20â§») âŠ‚"Score: " Â°â‹•  # ? Score
IsPadBallCollision   â† |2 I~Collide~Rects âŠ“(ËœâŠ‚â„‚PadW PadH|ËœâŠ‚â„‚ BallW BallHâŠ£)                 # ? PadPos Ball
IsBallBlockCollision â† |2 I~Collide~Rects âŠ“(âŠ‚âŠƒ(Block~Pos|Block~Size)|âŠ‚Ball~Pos Ë™â„‚BallSize) # b ? Block Ball 

# Ball Blocks Score ? Ball Blocks Score
RunCollisionUpdate â† |3.3 (
  âŠ™âŠ™[]: # blocks ball blockacc score
  # ball blockacc score ? block ball blockacc score
  âˆ§(â—¡IsBallBlockCollision
    â¨¬(ğ„âŒâŠ‚ # no collision, block to blockacc
    | ğ„âŒâŠ‚âŠ™âŠ™âŠ™âˆ˜
      # 0   # Find axis of collision
      # â¨¬(âŠ“(â—Œ|âœ(âŠ¢Ball~Vel|Â¯)|âˆ˜|+â‚)
      # | âŠ“(â—Œ|âœ(âŠ£Ball~Vel|Â¯)|âˆ˜|+â‚))
    )
  )
)

# Main
I~Open [W H] "Breakbreak"

St
I~Loop!(
  I~Draw~Background Cat~Base
  â¥â‹…St Key~Down @R # Reset all keybind

  # Inputs
  â¥âœSt~Pad(â†¥ 0 -PadVel) Key~Down Key~Arrow @<            # Move left, adjust to bounds
  â¥âœSt~Pad(â†§ â„‚(-PadW W) H +PadVel) Key~Down Key~Arrow @> # Move right, adjust to bounds

  â£(âŠ¸(Â°Status~Running St~Status)
    âœ(St~Ball|âœâŠ£(â†§â„‚W H â†¥0) \+) # Advance ball

    â¥âœ(St~Ball|âœâŠ¢âœÂ°â„‚âŠ™Â¯) âŠ¸(âˆ¨âŠƒ(â‰¤0â—ŒÂ°â„‚âŠ£ St~Ball|IsPadBallCollision âŠƒ(St~Pad|St~Ball)))
    â¥âœ(St~Ball|âœâŠ¢âœÂ°â„‚Â¯) âŠ¸(âˆ¨âŠƒ(â‰¤0|â‰¥ -BallW W) âŠ™â—ŒÂ°â„‚ âŠ£ St~Ball)

    âŠ¸(â‰¥Hâ—ŒÂ°â„‚âŠ£ St~Ball) # If ball has exited below
    â¥(âŠ¸(=â‚€St~Lives)   # Change state depending on if â‰0 lives 
      â¨¬(Â°âŠ¸St~Ball âœâŠ¢â‹…0 St~Ball St
        Â°âŠ¸St~Status Status~Intermission
      | Â°âŠ¸St~Status Status~Lost)
    )

    # Collision with block
    âŠ¸(RunCollisionUpdate âŠƒ(St~Ball|St~Blocks|St~Score))
    âŠ™âŠ™Â°âŠ¸St~Score
    âŠ™Â°âŠ¸St~Blocks
    Â°âŠ¸St~Ball
  | âŠ¸(Â°Status~Intermission St~Status)
    I~Key~Down I~Key~Space
    â¥(Â°âŠ¸St~Ball (St~Ball St)
      Â°âŠ¸St~Status Status~Running
      âœSt~Lives-â‚
    )
    I~Draw~Text Cat~Text 20 â„‚ 10 -â‚‚â‚€H "Press <SPC> to continue by using a life"
  | âŠ¸(Â°Status~Lost St~Status)
    I~Draw~Text Cat~Text 20 â„‚30 -â‚‚â‚€Ã·â‚‚ H "You've lost, press R to reset"
  )

  # Blocks
  # âŠ™(âŠ™âŠ™[] # Ball Blocks Acc
  #  âœ:âˆ§(
  #    # Stack <- Block Ball CheckedBlocks
  #    â—¡(I~Collide~Rects âŠ“(â‰¡Â°â–¡â†™â‚‹â‚‚|âŠ‚ â„‚BallH BallW âŠ£)) # Collision?
  #    â¨¬(âŠƒ(â‹…âŠ™â‹…|ËœâŠ‚âŠ™â‹…âŠ™)                                # No collision, leave as checked
  #    | âŠ¸(âŠ“âŠ¡â‚‚âŠ£)                                     # Collision, find direction; don't re-add block
  #      â¨¬(âœâŠ¢âœÂ°â„‚âŠ™Â¯|âœâŠ¢âœÂ°â„‚Â¯)                           # Do the flip in the found direction
  #    )
  #  ))

  # Draw
  âŠ¸âŠƒ(
    DrawPad St~Pad
  | DrawBall St~Ball
  | DrawBlocks St~Blocks
  | DrawLives St~Lives
  | DrawScore St~Score
  )
)
